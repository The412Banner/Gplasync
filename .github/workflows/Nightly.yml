name: Nightly WCP Distribution
on:
  schedule:
    - cron: '0 0 * * *' # Runs every night at midnight
  workflow_dispatch:      # Allows you to run it manually

jobs:
  distribute:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Prepare Nightly File
        run: |
          # Replace 'your-file.wcp' with the actual name of the file in your repo
          CURRENT_DATE=$(date +'%Y-%m-%d')
          cp new.wcp dxvk-nightly-$CURRENT_DATE.wcp
          echo "Release Date: $CURRENT_DATE" > info.txt

      - name: Upload Nightly Artifact
        uses: actions/upload-artifact@v4
        with:
          name: dxvk-gplasync-nightly
          path: |
            dxvk-nightly-*.wcp
            info.txt

      - name: Create Nightly Release (Optional)
        uses: softprops/action-gh-release@v2
        if: success()
        with:
          tag_name: nightly-${{ github.run_id }}
          name: Nightly Build - $(date +'%Y-%m-%d')
          body: "This is an automated nightly distribution of the pre-provided DXVK GPLAsync .wcp file."
          files: dxvk-nightly-*.wcp
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
